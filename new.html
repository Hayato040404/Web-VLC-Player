<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>M3U „Éó„É¨„Ç§„É§„Éº - NetflixÈ¢®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://unpkg.com/video.js/dist/video-js.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #141414;
      color: #fff;
    }
    header {
      background: #000;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: #e50914;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header select {
      background: #222;
      color: #fff;
      border: none;
      padding: 0.5rem;
      font-size: 1rem;
    }
    main {
      padding: 1rem;
    }
    #fileInput {
      margin-bottom: 1rem;
      padding: 0.5rem;
      font-size: 1rem;
    }
    .playlist {
      display: flex;
      overflow-x: auto;
      gap: 1rem;
      padding: 1rem 0;
    }
    .item {
      flex: 0 0 auto;
      width: 160px;
      cursor: pointer;
      background: #222;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    .item:hover {
      transform: scale(1.05);
    }
    .item img {
      width: 100%;
      height: 90px;
      object-fit: cover;
      background: #333;
    }
    .item-title {
      padding: 0.5rem;
      font-size: 0.9rem;
      text-align: center;
    }
    .player-container {
      margin-top: 1rem;
      max-width: 720px;
      margin-left: auto;
      margin-right: auto;
    }
    video {
      width: 100%;
      height: auto;
    }
    footer {
      text-align: center;
      padding: 1rem;
      color: #999;
      font-size: 0.8rem;
    }
    #loading {
      display: none;
      text-align: center;
      margin: 1rem;
      font-size: 1rem;
      color: #e50914;
    }
    @media (max-width: 600px) {
      .item {
        width: 120px;
      }
    }
  </style>
</head>
<body>
  <header>
    <span id="title">üçø M3U „Éó„É¨„Ç§„É§„Éº</span>
    <select id="langSelect">
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="en">English</option>
    </select>
  </header>
  <main>
    <input id="fileInput" type="file" accept=".m3u,.m3u8" />
    <div id="loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
    <div class="playlist" id="playlist"></div>
    <div class="player-container">
      <video id="videoPlayer" class="video-js vjs-default-skin" controls preload="auto"></video>
    </div>
  </main>
  <footer>Version 1.1 - Netflix Style Player</footer>

  <script src="https://unpkg.com/video.js/dist/video.min.js"></script>
  <script>
    const fileInput = document.getElementById('fileInput');
    const playlistEl = document.getElementById('playlist');
    const player = videojs('videoPlayer');
    const langSelect = document.getElementById('langSelect');
    const loading = document.getElementById('loading');
    const title = document.getElementById('title');

    const texts = {
      ja: {
        loading: "Ë™≠„ÅøËæº„Åø‰∏≠...",
        error: "ÂÜçÁîü„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü",
        title: "üçø M3U „Éó„É¨„Ç§„É§„Éº"
      },
      en: {
        loading: "Loading...",
        error: "Unable to play",
        title: "üçø M3U Player"
      }
    };

    let currentLang = 'ja';

    langSelect.addEventListener('change', (e) => {
      currentLang = e.target.value;
      updateLang();
    });

    function updateLang() {
      loading.textContent = texts[currentLang].loading;
      title.textContent = texts[currentLang].title;
    }

    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) return;

      loading.style.display = 'block';

      const reader = new FileReader();
      reader.onload = function (e) {
        const content = e.target.result;
        const lines = content.split('\n');
        const playlist = [];

        let current = {};

        lines.forEach((line) => {
          line = line.trim();
          if (line.startsWith('#EXTINF')) {
            const titleMatch = line.match(/,(.+)$/);
            const logoMatch = line.match(/tvg-logo=["']?([^"'\s]+)/);
            const title = titleMatch ? titleMatch[1] : 'ÁÑ°È°å';
            const logo = logoMatch ? logoMatch[1] : '';
            current = { title, logo };
          } else if (line.startsWith('http')) {
            current.url = line;
            playlist.push({ ...current });
          }
        });

        renderPlaylist(playlist);
        loading.style.display = 'none';
      };
      reader.readAsText(file);
    });

    function renderPlaylist(list) {
      playlistEl.innerHTML = '';
      list.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'item';
        const thumb = item.logo ? item.logo : `https://via.placeholder.com/160x90.png?text=${encodeURIComponent(item.title)}`;
        div.innerHTML = `
          <img src="${thumb}" alt="${item.title}" />
          <div class="item-title">${item.title}</div>
        `;
        div.onclick = () => {
          try {
            player.src({ src: item.url, type: 'application/x-mpegURL' });
            player.play();
          } catch (err) {
            alert(texts[currentLang].error + ": " + err.message);
          }
        };
        playlistEl.appendChild(div);
      });
    }

    updateLang();
  </script>
</body>
</html>
